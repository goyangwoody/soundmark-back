components:
  schemas:
    ActiveRecommendation:
      description: Individual active recommendation (within 200m)
      properties:
        distance_meters:
          title: Distance Meters
          type: number
        id:
          title: Id
          type: integer
        lat:
          title: Lat
          type: number
        like_count:
          default: 0
          title: Like Count
          type: integer
        liked:
          default: false
          title: Liked
          type: boolean
        lng:
          title: Lng
          type: number
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
        track:
          $ref: '#/components/schemas/TrackResponse'
      required:
      - id
      - lat
      - lng
      - distance_meters
      - track
      title: ActiveRecommendation
      type: object
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          title: Detail
          type: array
      title: HTTPValidationError
      type: object
    InactiveCluster:
      description: Cluster of inactive recommendations (beyond 200m)
      properties:
        count:
          description: Number of recommendations in cluster
          title: Count
          type: integer
        lat:
          description: Center latitude of cluster
          title: Lat
          type: number
        lng:
          description: Center longitude of cluster
          title: Lng
          type: number
      required:
      - lat
      - lng
      - count
      title: InactiveCluster
      type: object
    MapResponse:
      description: Map view response with active and inactive recommendations
      properties:
        active_recommendations:
          description: Recommendations within 200m radius
          items:
            $ref: '#/components/schemas/ActiveRecommendation'
          title: Active Recommendations
          type: array
        inactive_counts:
          description: Clustered counts for distant recommendations
          items:
            $ref: '#/components/schemas/InactiveCluster'
          title: Inactive Counts
          type: array
      title: MapResponse
      type: object
    PlaceInput:
      description: Place information input (Google or manual)
      properties:
        address:
          anyOf:
          - type: string
          - type: 'null'
          title: Address
        google_place_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Google Place Id
        place_name:
          title: Place Name
          type: string
        source:
          description: '''google'' or ''manual'''
          title: Source
          type: string
      required:
      - source
      - place_name
      title: PlaceInput
      type: object
    RecommendationCreateRequest:
      description: Request model for creating a recommendation
      properties:
        lat:
          description: Latitude
          maximum: 90.0
          minimum: -90.0
          title: Lat
          type: number
        lng:
          description: Longitude
          maximum: 180.0
          minimum: -180.0
          title: Lng
          type: number
        message:
          anyOf:
          - maxLength: 500
            type: string
          - type: 'null'
          description: Short message about the track
          title: Message
        note:
          anyOf:
          - type: string
          - type: 'null'
          description: Longer note about the track
          title: Note
        place:
          anyOf:
          - $ref: '#/components/schemas/PlaceInput'
          - type: 'null'
        spotify_track_id:
          description: Spotify track ID
          title: Spotify Track Id
          type: string
      required:
      - lat
      - lng
      - spotify_track_id
      title: RecommendationCreateRequest
      type: object
    RecommendationDetailResponse:
      description: Detailed recommendation response (used in detail view)
      properties:
        address:
          anyOf:
          - type: string
          - type: 'null'
          title: Address
        created_at:
          format: date-time
          title: Created At
          type: string
        distance_meters:
          anyOf:
          - type: number
          - type: 'null'
          title: Distance Meters
        id:
          title: Id
          type: integer
        lat:
          title: Lat
          type: number
        like_count:
          default: 0
          title: Like Count
          type: integer
        liked:
          default: false
          title: Liked
          type: boolean
        lng:
          title: Lng
          type: number
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
        note:
          anyOf:
          - type: string
          - type: 'null'
          title: Note
        place_name:
          anyOf:
          - type: string
          - type: 'null'
          title: Place Name
        track:
          $ref: '#/components/schemas/TrackResponse'
        user:
          $ref: '#/components/schemas/UserResponse'
      required:
      - id
      - lat
      - lng
      - track
      - user
      - created_at
      title: RecommendationDetailResponse
      type: object
    RecommendationLikeResponse:
      description: Response for like toggle operation
      properties:
        like_count:
          title: Like Count
          type: integer
        liked:
          title: Liked
          type: boolean
      required:
      - liked
      - like_count
      title: RecommendationLikeResponse
      type: object
    RecommendationResponse:
      description: Basic recommendation response (used in list views)
      properties:
        created_at:
          format: date-time
          title: Created At
          type: string
        distance_meters:
          anyOf:
          - type: number
          - type: 'null'
          title: Distance Meters
        id:
          title: Id
          type: integer
        lat:
          title: Lat
          type: number
        like_count:
          default: 0
          title: Like Count
          type: integer
        liked:
          default: false
          title: Liked
          type: boolean
        lng:
          title: Lng
          type: number
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
        track:
          $ref: '#/components/schemas/TrackResponse'
        user:
          $ref: '#/components/schemas/UserResponse'
      required:
      - id
      - lat
      - lng
      - track
      - user
      - created_at
      title: RecommendationResponse
      type: object
    SpotifyLoginResponse:
      description: Response model for Spotify login URL
      properties:
        authorization_url:
          title: Authorization Url
          type: string
      required:
      - authorization_url
      title: SpotifyLoginResponse
      type: object
    TokenResponse:
      description: Response model for authentication token
      properties:
        access_token:
          title: Access Token
          type: string
        expires_in:
          title: Expires In
          type: integer
        token_type:
          default: bearer
          title: Token Type
          type: string
      required:
      - access_token
      - expires_in
      title: TokenResponse
      type: object
    TrackResponse:
      description: Track response model
      properties:
        album:
          anyOf:
          - type: string
          - type: 'null'
          title: Album
        album_cover_url:
          anyOf:
          - type: string
          - type: 'null'
          title: Album Cover Url
        artist:
          title: Artist
          type: string
        created_at:
          format: date-time
          title: Created At
          type: string
        id:
          title: Id
          type: integer
        preview_url:
          anyOf:
          - type: string
          - type: 'null'
          title: Preview Url
        spotify_track_id:
          title: Spotify Track Id
          type: string
        title:
          title: Title
          type: string
        track_url:
          anyOf:
          - type: string
          - type: 'null'
          title: Track Url
      required:
      - spotify_track_id
      - title
      - artist
      - id
      - created_at
      title: TrackResponse
      type: object
    UserResponse:
      description: Response model for user information
      properties:
        created_at:
          format: date-time
          title: Created At
          type: string
        display_name:
          anyOf:
          - type: string
          - type: 'null'
          title: Display Name
        email:
          anyOf:
          - type: string
          - type: 'null'
          title: Email
        id:
          title: Id
          type: integer
        profile_image_url:
          anyOf:
          - type: string
          - type: 'null'
          title: Profile Image Url
        spotify_id:
          title: Spotify Id
          type: string
      required:
      - id
      - spotify_id
      - created_at
      title: UserResponse
      type: object
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          title: Location
          type: array
        msg:
          title: Message
          type: string
        type:
          title: Error Type
          type: string
      required:
      - loc
      - msg
      - type
      title: ValidationError
      type: object
  securitySchemes:
    HTTPBearer:
      scheme: bearer
      type: http
info:
  description: Location-based social music recommendation platform
  title: Soundmark API
  version: 0.1.0
openapi: 3.1.0
paths:
  /:
    get:
      description: "Root endpoint with API information\n\nReturns:\n    Welcome message\
        \ and links"
      operationId: root__get
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
      summary: Root
      tags:
      - Root
  /api/v1/auth/me:
    get:
      description: "Get current authenticated user information\n\nRequires:\n    Valid\
        \ JWT token in Authorization header\n    \nReturns:\n    Current user information"
      operationId: get_current_user_info_api_v1_auth_me_get
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
          description: Successful Response
      security:
      - HTTPBearer: []
      summary: Get Current User Info
      tags:
      - Authentication
  /api/v1/auth/refresh:
    post:
      description: "Refresh JWT token\n\nThis endpoint can be used to get a new JWT\
        \ token.\nIn the future, this could also refresh the Spotify token if needed.\n\
        \nRequires:\n    Valid JWT token in Authorization header\n    \nReturns:\n\
        \    New JWT access token"
      operationId: refresh_token_api_v1_auth_refresh_post
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
          description: Successful Response
      security:
      - HTTPBearer: []
      summary: Refresh Token
      tags:
      - Authentication
  /api/v1/auth/spotify/callback:
    post:
      description: "Handle Spotify OAuth callback\n\nExchange authorization code for\
        \ tokens, create or update user,\nand return our service JWT token\n\nArgs:\n\
        \    code: Authorization code from Spotify OAuth\n    db: Database session\n\
        \    \nReturns:\n    JWT access token for our service"
      operationId: spotify_callback_api_v1_auth_spotify_callback_post
      parameters:
      - description: Authorization code from Spotify
        in: query
        name: code
        required: true
        schema:
          description: Authorization code from Spotify
          title: Code
          type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      summary: Spotify Callback
      tags:
      - Authentication
  /api/v1/auth/spotify/login:
    get:
      description: "Get Spotify authorization URL for user to login\n\nReturns:\n\
        \    URL to redirect user to Spotify login page"
      operationId: spotify_login_api_v1_auth_spotify_login_get
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SpotifyLoginResponse'
          description: Successful Response
      summary: Spotify Login
      tags:
      - Authentication
  /api/v1/map/nearby:
    get:
      description: "Get map data with active and inactive recommendations\n\n**Active\
        \ recommendations**: Within 200m radius, returns full details\n**Inactive\
        \ counts**: Beyond 200m, returns clustered counts\n\nRequires authentication.\n\
        \nArgs:\n    lat: User's current latitude\n    lng: User's current longitude\n\
        \    current_user: Authenticated user\n    db: Database session\n    \nReturns:\n\
        \    Map data with active recommendations and inactive clusters"
      operationId: get_nearby_map_data_api_v1_map_nearby_get
      parameters:
      - description: User's current latitude
        in: query
        name: lat
        required: true
        schema:
          description: User's current latitude
          maximum: 90.0
          minimum: -90.0
          title: Lat
          type: number
      - description: User's current longitude
        in: query
        name: lng
        required: true
        schema:
          description: User's current longitude
          maximum: 180.0
          minimum: -180.0
          title: Lng
          type: number
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MapResponse'
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Get Nearby Map Data
      tags:
      - Map
  /api/v1/recommendations:
    post:
      description: "Create a new recommendation\n\nRequires authentication.\n\nArgs:\n\
        \    request: Recommendation creation data\n    current_user: Authenticated\
        \ user\n    db: Database session\n    \nReturns:\n    Created recommendation"
      operationId: create_recommendation_endpoint_api_v1_recommendations_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecommendationCreateRequest'
        required: true
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecommendationResponse'
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Create Recommendation Endpoint
      tags:
      - Recommendations
  /api/v1/recommendations/{recommendation_id}:
    get:
      description: "Get recommendation detail\n\n**Distance restriction**: User must\
        \ be within 200m of the recommendation\nto access full details.\n\nRequires\
        \ authentication.\n\nArgs:\n    recommendation_id: Recommendation ID\n   \
        \ lat: User's current latitude\n    lng: User's current longitude\n    current_user:\
        \ Authenticated user\n    db: Database session\n    \nReturns:\n    Recommendation\
        \ detail\n    \nRaises:\n    403: If user is outside 200m radius\n    404:\
        \ If recommendation not found"
      operationId: get_recommendation_detail_api_v1_recommendations__recommendation_id__get
      parameters:
      - in: path
        name: recommendation_id
        required: true
        schema:
          title: Recommendation Id
          type: integer
      - description: Current user latitude
        in: query
        name: lat
        required: true
        schema:
          description: Current user latitude
          maximum: 90.0
          minimum: -90.0
          title: Lat
          type: number
      - description: Current user longitude
        in: query
        name: lng
        required: true
        schema:
          description: Current user longitude
          maximum: 180.0
          minimum: -180.0
          title: Lng
          type: number
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecommendationDetailResponse'
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Get Recommendation Detail
      tags:
      - Recommendations
  /api/v1/recommendations/{recommendation_id}/like:
    put:
      description: "Toggle like on a recommendation\n\nIf user has already liked,\
        \ it will unlike.\nIf user hasn't liked, it will like.\n\nRequires authentication.\n\
        \nArgs:\n    recommendation_id: Recommendation ID\n    current_user: Authenticated\
        \ user\n    db: Database session\n    \nReturns:\n    Current like status\
        \ and count\n    \nRaises:\n    404: If recommendation not found"
      operationId: toggle_recommendation_like_api_v1_recommendations__recommendation_id__like_put
      parameters:
      - in: path
        name: recommendation_id
        required: true
        schema:
          title: Recommendation Id
          type: integer
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecommendationLikeResponse'
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Toggle Recommendation Like
      tags:
      - Recommendations
  /health:
    get:
      description: "Health check endpoint\n\nReturns:\n    Status of the service"
      operationId: health_check_health_get
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
      summary: Health Check
      tags:
      - Health
